<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uc Ghor - User Panel (Firebase)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        /* ================= VARIABLES & RESET ================= */
        :root {
            --primary: #008751;
            --bg-color: #f4f7fa;
            --white: #ffffff;
            --danger: #e74c3c;
            --warning: #fff3cd;
            --text-dark: #2c3e50;
            --gray: #7f8c8d;
            --radius: 8px;
            --shadow: 0 2px 10px rgba(0,0,0,0.05);
            --max-width: 480px;
            --orange: #e67e22;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', 'Hind Siliguri', sans-serif; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: #eef2f5;
            color: var(--text-dark);
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: var(--max-width);
            background-color: var(--bg-color);
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding-bottom: 75px;
            overflow-x: hidden;
        }

        /* HEADER FIX */
        .fixed-header-wrapper {
            position: fixed;
            top: 0;
            width: 100%;
            max-width: var(--max-width);
            z-index: 999;
            background: var(--white);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        #main-app {
            padding-top: 110px;
        }
        
        .header {
            background: var(--white);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo { font-size: 20px; font-weight: 700; color: #333; display: flex; align-items: center; gap: 5px; }
        .wallet-badge {
            background-color: var(--primary);
            color: var(--white);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: flex; align-items: center; gap: 5px;
        }
        .profile-icon {
            width: 35px; height: 35px; background: #e3f2fd; color: #1565c0;
            border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; margin-left: 10px;
        }

        /* AUTH PAGES */
        .auth-container { padding: 40px 20px; display: flex; flex-direction: column; justify-content: center; height: 90vh; }
        .auth-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; color: var(--primary); text-align: center; }
        .auth-subtitle { text-align: center; color: var(--gray); margin-bottom: 30px; font-size: 14px; }

        /* COMMON COMPONENTS */
        .btn {
            display: block; width: 100%; padding: 12px;
            border: none; border-radius: var(--radius);
            font-size: 16px; font-weight: 600; cursor: pointer; text-align: center; transition: 0.3s;
        }
        .btn-primary { background-color: var(--primary); color: var(--white); }
        .btn-danger { background-color: var(--danger); color: var(--white); }
        .btn-outline { border: 1px solid var(--primary); color: var(--primary); background: transparent; }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }

        .card {
            background: var(--white); border-radius: var(--radius);
            box-shadow: var(--shadow); padding: 15px; margin: 10px 15px;
        }
        .section-title {
            font-size: 18px; font-weight: 700; margin: 20px 15px 10px;
            color: var(--text-dark); text-transform: uppercase; text-align: center;
        }

        /* INPUTS */
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 14px; }
        .input-group input {
            width: 100%; padding: 12px; border: 1px solid #ddd;
            border-radius: var(--radius); font-size: 16px; outline: none;
        }
        .input-group input:focus { border-color: var(--primary); }

        /* HOME ELEMENTS */
        .notice-bar {
            background-color: var(--primary); color: var(--white);
            padding: 10px 15px; font-size: 13px; display: flex; justify-content: space-between; align-items: center;
        }
        
        /* DYNAMIC SLIDER */
        .slider-container { width: 100%; height: 160px; background-color: #ddd; position: relative; overflow: hidden; }
        .slider-wrapper { display: flex; height: 100%; transition: transform 0.5s ease-in-out; }
        .slider-slide { min-width: 100%; height: 100%; }
        .slider-slide img { width: 100%; height: 100%; object-fit: cover; }

        .ticker-container {
            background: var(--warning); color: #856404; padding: 8px 0;
            overflow: hidden; white-space: nowrap; font-size: 12px; border-bottom: 1px solid #ffeeba;
        }
        .ticker-text { display: inline-block; animation: ticker 20s linear infinite; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 15px; }
        .product-item {
            background: var(--white); border-radius: var(--radius);
            box-shadow: var(--shadow); padding: 8px; text-align: center; cursor: pointer;
        }
        .product-item img { width: 100%; height: 100px; object-fit: cover; border-radius: 5px; }
        .product-item h4 { font-size: 13px; margin-top: 8px; font-weight: 600; }

        .action-card-row {
            display: flex; align-items: center; gap: 15px; background: var(--white);
            padding: 15px; margin: 10px 15px; border-radius: var(--radius);
            box-shadow: var(--shadow); cursor: pointer;
        }
        .action-icon-box { font-size: 24px; color: var(--primary); width: 30px; text-align: center; }

        /* ORDER PAGE & PACKAGES */
        .order-top { display: flex; justify-content: space-between; font-weight: bold; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px; }
        .step-header { font-weight: bold; font-size: 16px; margin-bottom: 10px; display: flex; align-items: center; }
        .step-badge { background: var(--primary); color: white; width: 25px; height: 25px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 14px; margin-right: 5px; font-weight: bold; }
        
        .pay-option-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer; position: relative; }
        .pay-option-card.selected { border-color: var(--primary); background: #f0fff4; }
        .pay-check { position: absolute; top: 5px; left: 5px; color: var(--danger); font-size: 12px; }

        .package-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .package-card {
            background: var(--white); border: 1px solid #ddd; border-radius: 8px;
            padding: 12px 10px; cursor: pointer; position: relative;
            display: flex; justify-content: space-between; align-items: center;
            transition: 0.2s;
        }
        .package-card:hover { border-color: #ccc; }
        .package-card.active-pkg { border: 1.5px solid var(--orange); background: #fff8f0; }
        .pkg-check-icon { display: none; position: absolute; left: 5px; top: 5px; color: var(--orange); font-size: 12px; }
        .package-card.active-pkg .pkg-check-icon { display: block; }
        .pkg-name { font-size: 13px; font-weight: 500; color: #555; }
        .pkg-price { font-size: 13px; font-weight: 700; color: var(--orange); }

        /* ADD MONEY & DYNAMIC METHODS */
        .methods-row { display: flex; gap: 10px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .method-box { border: 2px solid #eee; width: 80px; height: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: var(--radius); cursor: pointer; background: white; padding: 5px; }
        .method-box.active { border-color: var(--primary); background: #e8f5e9; }
        .method-box img { max-width: 50px; max-height: 40px; margin-bottom: 5px; object-fit: contain; }
        .method-name { font-size: 10px; font-weight: bold; color: #555; }
        
        .instruction-card { color: white; padding: 20px; border-radius: var(--radius); margin-bottom: 20px; }
        .instruction-line { margin-bottom: 10px; font-size: 14px; display: flex; align-items: start; gap: 8px; }
        .copy-btn { background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; border: 1px solid rgba(255,255,255,0.5); }

        /* TRANSACTIONS & ORDERS LIST */
        .trx-table-header { display: grid; grid-template-columns: 2fr 1.5fr 1fr; background: #eee; padding: 10px; font-weight: bold; font-size: 12px; color: #555; text-align: center; border-bottom: 1px solid #ddd; }
        .trx-row { display: grid; grid-template-columns: 2fr 1.5fr 1fr; padding: 12px 5px; border-bottom: 1px solid #eee; background: white; align-items: center; text-align: center; font-size: 12px; }
        .trx-meta { text-align: left; padding-left: 5px; font-size: 11px; color: #777; line-height: 1.4; }
        .trx-id { font-weight: bold; color: #333; font-size: 11px; display:block; margin-top:2px; }
        
        .order-item { background: white; padding: 15px; margin: 10px 15px; border-radius: 8px; box-shadow: var(--shadow); border-left: 5px solid #ddd; }
        .st-processing { border-left-color: #ffc107; }
        .st-approved { border-left-color: var(--primary); }
        .st-rejected { border-left-color: var(--danger); }
        .status-badge { padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; text-transform: uppercase; background: #eee; color: #555; }
        .sb-processing { background: #fff3cd; color: #856404; }
        .sb-approved { background: #d4edda; color: #155724; }
        .sb-rejected { background: #f8d7da; color: #721c24; }

        /* CONTACT MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 90%; max-width: 350px; border-radius: 12px; padding: 20px; text-align: center; position: relative; }
        .modal-btn-row { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .contact-btn { padding: 12px; border-radius: 8px; color: white; text-decoration: none; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-wa { background-color: #25D366; }
        .btn-tg { background-color: #0088cc; }
        .close-modal { position: absolute; top: 10px; right: 15px; font-size: 20px; cursor: pointer; color: #999; }

        /* HOW TO WORK */
        .video-card { background: var(--white); border-radius: var(--radius); box-shadow: var(--shadow); margin: 15px; overflow: hidden; }
        .video-thumb { height: 180px; background: #000; position: relative; display: flex; justify-content: center; align-items: center; }
        .video-info { padding: 15px; }
        .video-info h4 { margin: 0 0 5px 0; font-size: 15px; }
        .video-info p { margin: 0; font-size: 12px; color: #777; }

        /* ACCOUNT */
        .profile-header { text-align: center; padding: 20px; background: var(--white); margin-bottom: 15px; }
        .avatar-circle { width: 70px; height: 70px; background: #e3f2fd; color: #1565c0; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 30px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 15px; margin-bottom: 20px; }
        .stat-box { background: var(--white); padding: 15px; text-align: center; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid #eee; }
        .stat-val { font-size: 18px; font-weight: 700; color: var(--primary); }
        .stat-lbl { font-size: 12px; color: var(--gray); margin-top: 5px; }
        .balance-bar { background: var(--primary); color: white; padding: 15px; text-align: center; border-radius: var(--radius); margin: 0 15px 15px; font-size: 18px; font-weight: 600; }
        .verified-badge { background: #e3f2fd; color: #1976d2; padding: 8px; text-align: center; border-radius: var(--radius); margin: 0 15px 20px; font-weight: 500; display: flex; justify-content: center; gap: 5px; }

        /* NAV & FAB */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; max-width: var(--max-width); height: 65px; background: var(--white); display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 100; }
        .nav-item { text-align: center; color: var(--gray); font-size: 11px; cursor: pointer; flex: 1; }
        .nav-item i { display: block; font-size: 20px; margin-bottom: 3px; }
        .nav-item.active { color: var(--primary); }

        .fab-wrapper { position: fixed; bottom: 80px; right: 20px; z-index: 200; display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
        .fab-main { background: var(--danger); color: white; padding: 10px 15px; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 8px; }
        .fab-menu { display: none; flex-direction: column; gap: 8px; }
        .fab-item { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; cursor: pointer; }
        .bg-whatsapp { background: #25D366; } .bg-telegram { background: #0088cc; }

        /* SIDE MENU */
        .side-menu { position: fixed; top: 0; left: -300px; width: 280px; height: 100%; background: var(--white); z-index: 1000; transition: 0.3s; box-shadow: 2px 0 10px rgba(0,0,0,0.1); overflow-y: auto; }
        .side-menu.open { left: 0; }
        .menu-header { padding: 20px; border-bottom: 1px solid #eee; }
        .menu-list a { display: flex; align-items: center; padding: 12px 20px; color: #333; text-decoration: none; font-size: 15px; border-bottom: 1px solid #f9f9f9; }
        .menu-list a i { width: 25px; color: var(--gray); }
        .support-btn-menu { margin: 20px; background: var(--primary); color: white; text-align: center; padding: 10px; border-radius: var(--radius); display: block; text-decoration: none; }
        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999; display: none; }
        .overlay.active { display: block; }

        /* UTIL */
        .page-section { display: none; }
        .page-section.active { display: block; }
        .empty-state { text-align: center; padding: 50px 20px; color: #999; }
        .hide { display: none !important; }

        /* LOADING SPINNER */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
        }
        .spinner {
            border: 5px solid #f3f3f3; border-top: 5px solid var(--primary);
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

<div id="loader"><div class="spinner"></div></div>

<div class="container">

    <div id="maintenance-screen" style="display:none; text-align:center; padding:50px; height:100vh; background:white; z-index:10000; position:fixed; top:0; width:100%; max-width:480px;">
        <i class="fas fa-tools" style="font-size:50px; color:var(--orange);"></i>
        <h2 style="margin-top:20px;">Maintenance Mode</h2>
        <p>আমরা সিস্টেম আপডেট করছি। দয়া করে কিছুক্ষণ পর আবার চেষ্টা করুন।</p>
    </div>

    <div id="pg-login" class="page-section">
        <div class="auth-container">
            <div style="text-align:center; margin-bottom:20px;">
                <i class="fas fa-gem" style="font-size:50px; color:var(--primary);"></i>
            </div>
            <div class="auth-title">Welcome Back</div>
            <div class="auth-subtitle">Login to your account</div>
            
            <div class="input-group">
                <label>Email</label>
                <input type="email" id="loginEmail" placeholder="Enter email">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="loginPass" placeholder="******">
            </div>
            
            <button class="btn btn-primary" onclick="handleLogin()">LOGIN</button>
            
            <div style="text-align:center; margin-top:20px; font-size:14px;">
                Don't have an account? <span style="color:var(--primary); cursor:pointer; font-weight:bold;" onclick="router('register')">Register</span>
            </div>
        </div>
    </div>

    <div id="pg-register" class="page-section">
        <div class="auth-container">
            <div class="auth-title">Create Account</div>
            <div class="auth-subtitle">Join us today!</div>
            
            <div class="input-group">
                <label>Full Name</label>
                <input type="text" id="regName" placeholder="Your Name">
            </div>
            <div class="input-group">
                <label>Mobile Number (11 Digit)</label>
                <input type="number" id="regMobile" placeholder="01XXXXXXXXX">
            </div>
            <div class="input-group">
                <label>Email</label>
                <input type="email" id="regEmail" placeholder="example@mail.com">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="regPass" placeholder="******">
            </div>
            <div class="input-group">
                <label>Referral Code (Optional)</label>
                <input type="text" id="regRef" placeholder="Enter Referral Code">
            </div>
            
            <button class="btn btn-primary" onclick="handleRegister()">REGISTER</button>
            
            <div style="text-align:center; margin-top:20px; font-size:14px;">
                Already have an account? <span style="color:var(--primary); cursor:pointer; font-weight:bold;" onclick="router('login')">Login</span>
            </div>
        </div>
    </div>

    <div id="main-app" class="hide">
        
        <div class="fixed-header-wrapper">
            <header class="header">
                <div class="logo"><i class="fas fa-gem" style="color:var(--primary)"></i> UC GHOR</div>
                <div style="display:flex; align-items:center;">
                    <div class="wallet-badge"><i class="fas fa-wallet"></i> <span id="headerBalance">0.00</span> ৳</div>
                    <div class="profile-icon" onclick="toggleSideMenu()"><i class="fas fa-user"></i></div>
                </div>
            </header>
            
            <div class="notice-bar" id="noticeBar">
                <span id="noticeText">...</span>
                <i class="fas fa-times" style="cursor:pointer" onclick="document.getElementById('noticeBar').style.display='none'"></i>
            </div>
        </div>

        <div id="pg-home" class="page-section">
            
            <div class="slider-container">
                <div class="slider-wrapper" id="sliderWrapper"></div>
            </div>

            <div class="ticker-container">
                <div class="ticker-text" id="tickerText">Loading notice...</div>
            </div>

            <div id="hotProductsSection" style="display:none;">
                <div class="section-title">HOT PRODUCTS</div>
                <div id="offerListContainer"></div>
            </div>

            <div id="dynamicGamesContainer"></div>

            <div class="action-card-row" style="background:#222; color:white;">
                <div class="action-icon-box"><i class="fab fa-google-play"></i></div>
                <div><h5 style="margin:0">Download App</h5><small>Click Here</small></div>
            </div>
            <div class="action-card-row" style="background:#0088cc; color:white;" onclick="openContactModal()">
                <div class="action-icon-box" style="color:white"><i class="fab fa-telegram"></i></div>
                <div><h5 style="margin:0">Join Telegram</h5><small>For Updates</small></div>
            </div>
        </div>

        <div id="pg-order-form" class="page-section">
            <div class="card" style="margin-top:15px;">
                <div class="order-top">
                    <span id="orderTitleDisplay">Title</span>
                    <span style="color:orange;" id="orderPriceDisplay">0 TK</span>
                </div>
            </div>
            <div style="padding:0 15px;">
                <p style="color:#e74c3c; font-size:14px; margin-bottom:15px;"><i class="far fa-share-square"></i> কিভাবে অর্ডার করবেন ?</p>
                
                <div id="packageSelectionSection">
                    <div class="step-header"><div class="step-badge">1</div> Select Recharge</div>
                    <div id="packageGridContainer" class="package-grid">
                        </div>
                </div>

                <div class="step-header"><div class="step-badge">2</div> Account Info</div>
                <div class="card" style="margin:0 0 20px 0;">
                    <label style="font-weight:bold; font-size:14px;">Player Id / Info</label>
                    <input type="text" id="playerIdInput" placeholder="Player Id" style="width:100%; padding:10px; margin:5px 0 15px 0; border:1px solid #ddd; border-radius:5px;">
                    <button class="btn btn-primary" onclick="checkUID()">আইডি চেক করুন (Demo)</button>
                </div>

                <div class="step-header"><div class="step-badge">3</div> Select one option</div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <div class="pay-option-card selected" onclick="selectPayOption(this, 'wallet')">
                        <div class="pay-check"><i class="fas fa-check"></i></div>
                        <img src="https://via.placeholder.com/30/orange/fff?text=W" alt="">
                        <div><b>Wallet Pay</b></div>
                    </div>
                    <div class="pay-option-card" onclick="selectPayOption(this, 'instant')">
                        <img src="https://via.placeholder.com/60x30/fff/red?text=Auto" alt="">
                        <div style="font-size:12px;"><b>Instant Pay</b></div>
                    </div>
                </div>

                <div style="text-align:center; margin:20px 0; font-size:12px; color:#666;">
                    <i class="fas fa-info-circle"></i> আপনার একাউন্ট ব্যালেন্স ৳ <span id="orderPageBalance">0.00</span>
                </div>

                <button class="btn btn-primary" id="btnConfirmOrder" onclick="confirmOrder()">Buy Now</button>
                <button class="btn btn-outline" style="margin-top:10px;" onclick="router('home')">Cancel</button>
            </div>
        </div>

        <div id="pg-addmoney" class="page-section">
            <div class="section-title">ADD MONEY</div>
            
            <div id="am_step1" style="padding: 0 15px;">
                <div class="card">
                    <label class="input-label" style="font-weight:bold; font-size:14px; margin-bottom:5px; display:block;">Enter the amount</label>
                    <input type="number" id="amAmount" class="input-group input" style="width:100%; border:1px solid #ddd; padding:10px; border-radius:5px;" value="50">
                    <br><br>
                    <button class="btn btn-primary" onclick="amGoToStep2()">Click Here To Add Money</button>
                </div>
                <div class="card" id="addMoneyVideoContainer"></div>
            </div>

            <div id="am_step2" style="display:none; padding: 0 15px;">
                <div class="card" style="text-align:center;">
                    <h3><span id="displayAmount">0</span> Tk</h3>
                    <p style="color:#777; font-size:13px; margin-bottom:15px;">Select Payment Method</p>
                    <div class="methods-row" id="paymentMethodsContainer">
                        </div>
                </div>
                <button class="btn btn-outline" style="margin:0 15px;" onclick="amBackToStep1()">Back</button>
            </div>

            <div id="am_step3" style="display:none; padding: 0 15px;">
                <div class="instruction-card" id="instructionCard" style="background:#e73627;">
                    <h3 style="text-align:center; margin-bottom:20px;">ট্রানজেকশন আইডি দিন</h3>
                    <div class="instruction-line"><i class="fas fa-circle" style="font-size:8px; margin-top:6px;"></i> <span><b id="dialCode">*167#</b> ডায়াল করে মেনুতে যান।</span></div>
                    <div class="instruction-line"><i class="fas fa-circle" style="font-size:8px; margin-top:6px;"></i> <span>"Send Money" এ ক্লিক করুন।</span></div>
                    <div class="instruction-line"><i class="fas fa-circle" style="font-size:8px; margin-top:6px;"></i> <span>প্রাপক নম্বর: <b id="adminNumber">01xxxx</b> <span class="copy-btn">Copy</span></span></div>
                    <div class="instruction-line"><i class="fas fa-circle" style="font-size:8px; margin-top:6px;"></i> <span>টাকার পরিমাণ: <b id="finalAm">50</b></span></div>
                    <div class="input-group" style="margin-top:20px;">
                        <input type="text" id="trxIDInput" placeholder="ট্রানজেকশন আইডি দিন" class="input-group input" style="width:100%; border:none; padding:10px; border-radius:5px; color:black;">
                    </div>
                    <button class="btn btn-warning" id="btnSubmitTrx" style="background:#ffc107; color:black; font-weight:bold; margin-top:10px;" onclick="submitVerify()">VERIFY</button>
                </div>
                <button class="btn btn-danger" onclick="resetAddMoney()">CANCEL</button>
            </div>
        </div>

        <div id="pg-transactions" class="page-section">
            <div class="section-title">All Transaction</div>
            <div class="card" style="padding:0; overflow:hidden;">
                <div class="trx-table-header">
                    <div>DETAILS</div> <div>INFO</div> <div>AMOUNT</div>
                </div>
                <div id="trxListContainer">
                    <div class="trx-row" style="text-align:center; color:#999; padding:20px;">Loading...</div>
                </div>
            </div>
        </div>

        <div id="pg-orders" class="page-section">
            <div class="section-title">MY ORDERS</div>
            <div id="orderListContainer">
                <div class="empty-state">Loading...</div>
            </div>
            <div style="text-align:center; margin-top:20px;">
                <button class="btn btn-danger" style="width:auto; display:inline-block;" onclick="router('home')">ORDER NOW</button>
            </div>
        </div>

        <div id="pg-howtowork" class="page-section">
            <div class="section-title">HOW TO WORK</div>
            <div style="padding:0 15px;" id="videoListContainer"></div>
        </div>

        <div id="pg-account" class="page-section">
            <div class="card" style="text-align:center; padding:20px;">
                <div class="avatar-circle"><i class="fas fa-user"></i></div>
                <h3>Hi, <span id="profileName">...</span></h3>
                <p style="color:#666;">Available Balance : <span id="acBalance">0.00</span> Tk</p>
            </div>

            <div class="stats-grid">
                <div class="stat-box"><div class="stat-val" id="profilePin">...</div><div class="stat-lbl">Support Pin</div></div>
                <div class="stat-box"><div class="stat-val"><span id="weeklySpent">0</span> ৳</div><div class="stat-lbl">Weekly Spent</div></div>
                <div class="stat-box"><div class="stat-val"><span id="totalSpent">0</span> ৳</div><div class="stat-lbl">Total Spent</div></div>
                <div class="stat-box"><div class="stat-val" id="totalOrder">0</div><div class="stat-lbl">Total Order</div></div>
            </div>

            <div class="section-title" style="margin-left:15px; font-size:16px;">Account Information</div>
            <div class="balance-bar">Available Balance <div style="font-size:24px; margin-top:5px;"><span id="largeBalance">0.00</span>৳</div></div>
            <div class="verified-badge"><i class="fas fa-check-circle"></i> Account Verified!</div>

            <div class="card">
                <h5 style="margin-bottom:10px;">User Information</h5>
                <p style="font-size:14px; margin-bottom:5px;"><b>Email:</b> <span id="profileEmail">...</span></p>
                <p style="font-size:14px;"><b>Phone:</b> <span id="profilePhone">...</span></p>
            </div>
        </div>

        <div class="modal-overlay" id="contactModal">
            <div class="modal-content">
                <div class="close-modal" onclick="closeContactModal()">&times;</div>
                <h3 style="margin-bottom:10px;">Contact Us</h3>
                <p style="font-size:13px; color:#666;">আমাদের সাথে যোগাযোগ করতে নিচের অপশন ব্যবহার করুন</p>
                <div class="modal-btn-row">
                    <a href="#" id="modalWaLink" class="contact-btn btn-wa" target="_blank"><i class="fab fa-whatsapp"></i> Chat on WhatsApp</a>
                    <a href="#" id="modalTgLink" class="contact-btn btn-tg" target="_blank"><i class="fab fa-telegram"></i> Chat on Telegram</a>
                </div>
            </div>
        </div>

        <div class="fab-wrapper">
            <div class="fab-menu" id="fabMenu">
                <div class="fab-item bg-whatsapp" id="fabWhatsapp"><i class="fab fa-whatsapp"></i></div>
                <div class="fab-item bg-telegram" id="fabTelegram"><i class="fab fa-telegram-plane"></i></div>
            </div>
            <div class="fab-main" onclick="openContactModal()">
                <span style="font-size:12px; font-weight:bold;">সাহায্য লাগবে ?</span>
                <i class="fas fa-phone-alt"></i>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" onclick="router('home')" id="nav-home"><i class="fas fa-home"></i> Home</div>
            <div class="nav-item" onclick="router('addmoney')" id="nav-addmoney"><i class="fas fa-plus-square"></i> Add Money</div>
            <div class="nav-item" onclick="router('orders')" id="nav-orders"><i class="fas fa-shopping-cart"></i> Orders</div>
            <div class="nav-item" onclick="router('howtowork')" id="nav-howtowork"><i class="fas fa-video"></i> Tutorials</div>
            <div class="nav-item" onclick="router('account')" id="nav-account"><i class="fas fa-user-circle"></i> Account</div>
        </nav>

        <div class="overlay" id="overlay" onclick="toggleSideMenu()"></div>
        <div class="side-menu" id="sideMenu">
            <div class="menu-header">
                <div style="display:flex; gap:10px; align-items:center;">
                    <div class="avatar-circle" style="width:50px; height:50px; font-size:20px; margin:0;"><i class="fas fa-user"></i></div>
                    <div class="menu-user-info">
                        <div style="font-weight:bold;" id="sideName">Hi, User</div>
                        <div style="font-size:12px; color:#666;" id="sideEmail">...</div>
                        <div class="logout-btn" onclick="handleLogout()" style="cursor:pointer; color:red; margin-top:5px;"><i class="fas fa-power-off"></i> Logout</div>
                    </div>
                </div>
            </div>
            <div class="menu-list">
                <a href="#" onclick="router('account'); toggleSideMenu()"><i class="fas fa-home"></i> My Account</a>
                <a href="#" onclick="router('orders'); toggleSideMenu()"><i class="fas fa-bookmark"></i> My Orders</a>
                <a href="#" onclick="router('howtowork'); toggleSideMenu()"><i class="fas fa-video"></i> How to Work</a>
                <a href="#" onclick="router('transactions'); toggleSideMenu()"><i class="fas fa-list"></i> My Transaction</a>
                <a href="#" onclick="router('addmoney'); toggleSideMenu()"><i class="fas fa-wallet"></i> Add Money</a>
                <a href="#" onclick="openContactModal(); toggleSideMenu()"><i class="fas fa-info-circle"></i> Contact Us</a>
            </div>
            <a href="#" id="sideSupport" class="support-btn-menu"><i class="fas fa-headset"></i> Support</a>
        </div>

    </div>

</div>

<script>
    // ================== FIREBASE CONFIGURATION ==================
    const firebaseConfig = {
  apiKey: "AIzaSyBb77FS5XciyqHEhnUiKPS0qzie_3cI76U",
  authDomain: "uc-ghor-abebb.firebaseapp.com",
  projectId: "uc-ghor-abebb",
  storageBucket: "uc-ghor-abebb.firebasestorage.app",
  messagingSenderId: "1007340356988",
  appId: "1:1007340356988:web:26fc387c40bf587a35d0f9",
  measurementId: "G-3DHXLL94F9"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ================== GLOBAL VARIABLES ==================
    let currentUserData = null;
    let currentUserUid = null;
    let userListener = null;
    let globalConfig = {}; // Stores admin settings dynamically

    // ================== INITIALIZATION ==================
    window.onload = function() {
        fetchGlobalSettings();
        
        auth.onAuthStateChanged((user) => {
            const loader = document.getElementById('loader');
            if (user) {
                currentUserUid = user.uid;
                listenToUserData(user.uid);
                router('home');
                // Load Dynamic Content
                renderDynamicHome();
                renderSlider();
                renderOffers();
            } else {
                currentUserData = null;
                currentUserUid = null;
                if(userListener) userListener();
                router('login');
                loader.style.display = 'none';
            }
        });
    };

    function fetchGlobalSettings() {
        db.collection('adminSettings').doc('config').onSnapshot(doc => {
            if(doc.exists) {
                globalConfig = doc.data();
                
                // Maintenance Check
                if(globalConfig.maintenance_mode === 'ON') {
                    document.getElementById('maintenance-screen').style.display = 'block';
                    document.getElementById('main-app').style.display = 'none';
                } else {
                    document.getElementById('maintenance-screen').style.display = 'none';
                }

                // Update UI Links
                const waLink = "https://wa.me/88" + globalConfig.whatsapp_number;
                document.getElementById('modalWaLink').href = waLink;
                document.getElementById('modalTgLink').href = globalConfig.telegram_link || "#";
                document.getElementById('fabWhatsapp').onclick = () => window.open(waLink, '_blank');
                document.getElementById('fabTelegram').onclick = () => window.open(globalConfig.telegram_link, '_blank');
                document.getElementById('sideSupport').href = globalConfig.support_call || "#";
                
                // Notice & Ticker
                document.getElementById('noticeText').innerText = globalConfig.notice_text || "Welcome";
                document.getElementById('tickerText').innerText = globalConfig.ticker_text || "Welcome to UC Ghor";
                
                // Show notice bar if text exists
                if(globalConfig.notice_text) document.getElementById('noticeBar').style.display = 'flex';
            }
        });
    }

    // ================== FIREBASE AUTHENTICATION ==================
    function listenToUserData(uid) {
        userListener = db.collection('users').doc(uid).onSnapshot((doc) => {
            document.getElementById('loader').style.display = 'none';
            if (doc.exists) {
                currentUserData = doc.data();
                updateUI(currentUserData);
            } else {
                auth.signOut(); 
            }
        }, (error) => {
            console.log(error);
            document.getElementById('loader').style.display = 'none';
        });
    }

    function handleLogin() {
        const email = document.getElementById('loginEmail').value;
        const pass = document.getElementById('loginPass').value;
        if(!email || !pass) { alert("Please enter email and password"); return; }
        
        document.getElementById('loader').style.display = 'flex';
        auth.signInWithEmailAndPassword(email, pass).catch((error) => {
            document.getElementById('loader').style.display = 'none';
            alert("Login Failed: " + error.message);
        });
    }

    function handleRegister() {
        const name = document.getElementById('regName').value;
        const phone = document.getElementById('regMobile').value;
        const email = document.getElementById('regEmail').value;
        const pass = document.getElementById('regPass').value;
        
        if(name && phone && email && pass) {
            document.getElementById('loader').style.display = 'flex';
            auth.createUserWithEmailAndPassword(email, pass)
                .then((cred) => {
                    const supportPin = "1" + Math.floor(1000 + Math.random() * 9000);
                    return db.collection('users').doc(cred.user.uid).set({
                        name: name, phone: phone, email: email, balance: 0,
                        pin: supportPin, regDate: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .catch((error) => {
                    document.getElementById('loader').style.display = 'none';
                    alert("Error: " + error.message);
                });
        } else {
            alert("Please fill all fields");
        }
    }

    function handleLogout() {
        if(confirm("Are you sure?")) auth.signOut();
    }

    // ================== UI UPDATES ==================
    function updateUI(user) {
        document.getElementById('headerBalance').innerText = user.balance.toFixed(2);
        document.getElementById('acBalance').innerText = user.balance.toFixed(2);
        document.getElementById('largeBalance').innerText = user.balance.toFixed(2);
        document.getElementById('profileName').innerText = user.name;
        document.getElementById('sideName').innerText = "Hi, " + user.name;
        document.getElementById('sideEmail').innerText = user.email;
        document.getElementById('profileEmail').innerText = user.email;
        document.getElementById('profilePhone').innerText = user.phone;
        document.getElementById('profilePin').innerText = user.pin;
        calculateStats();
    }

    function calculateStats() {
        if(!currentUserUid) return;
        db.collection('orders').where('user_uid', '==', currentUserUid).get().then((snap) => {
            let weekly = 0;
            let total = 0;
            let totalCount = snap.size;
            const oneWeekAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);

            snap.forEach(doc => {
                const o = doc.data();
                if(o.status === 'Approved' || o.status === 'Complete') {
                    total += parseFloat(o.price);
                    if(o.timestamp && o.timestamp.toMillis() > oneWeekAgo) {
                        weekly += parseFloat(o.price);
                    }
                }
            });
            document.getElementById('weeklySpent').innerText = weekly.toFixed(0);
            document.getElementById('totalSpent').innerText = total.toFixed(0);
            document.getElementById('totalOrder').innerText = totalCount;
        });
    }

    // ================== DYNAMIC HOME CONTENT (NEW) ==================
    function renderDynamicHome() {
        const container = document.getElementById('dynamicGamesContainer');
        
        // 1. Fetch Games
        db.collection('games').where('active', '==', 'YES').orderBy('sort_order', 'asc').get().then(gameSnap => {
            container.innerHTML = ""; // Clear existing
            
            gameSnap.forEach(gameDoc => {
                const game = gameDoc.data();
                
                // Create Section
                const section = document.createElement('div');
                section.innerHTML = `<div class="section-title">${game.name}</div>`;
                
                const grid = document.createElement('div');
                grid.className = "grid-container";
                grid.id = `grid-${game.key}`;
                
                section.appendChild(grid);
                container.appendChild(section);

                // 2. Fetch Products for this Game
                db.collection('products')
                  .where('game_key', '==', game.key)
                  .where('active', '==', 'YES')
                  .orderBy('sort_order', 'asc')
                  .get().then(prodSnap => {
                      prodSnap.forEach(prodDoc => {
                          const prod = prodDoc.data();
                          // Create Product Card
                          const html = `
                            <div class="product-item" onclick="openOrderPage('${prod.product_key}', '${prod.title}')">
                                <img src="${prod.image_url}" alt="${prod.title}">
                                <h4>${prod.title}</h4>
                            </div>`;
                          grid.innerHTML += html;
                      });
                  });
            });
        });
    }

    function renderSlider() {
        const wrapper = document.getElementById('sliderWrapper');
        db.collection('sliders').orderBy('sort_order').get().then(snap => {
            wrapper.innerHTML = '';
            let count = 0;
            snap.forEach(doc => {
                count++;
                wrapper.innerHTML += `<div class="slider-slide"><img src="${doc.data().url}"></div>`;
            });
            
            // Slider Animation Logic
            let slideIndex = 0;
            if(window.sliderInterval) clearInterval(window.sliderInterval);
            if(count > 1) {
                window.sliderInterval = setInterval(() => {
                    slideIndex++;
                    if(slideIndex >= count) slideIndex = 0;
                    wrapper.style.transform = `translateX(-${slideIndex * 100}%)`;
                }, 3000);
            }
        });
    }

    function renderOffers() {
        const container = document.getElementById('offerListContainer');
        const section = document.getElementById('hotProductsSection');
        
        db.collection('hot_products').get().then(snap => {
            if(snap.empty) { section.style.display = 'none'; return; }
            section.style.display = 'block';
            container.innerHTML = "";
            
            snap.forEach(doc => {
                const o = doc.data();
                const html = `
                <div class="card" style="padding:0; overflow:hidden; text-align:center; cursor:pointer;" onclick="openOrderPage('${o.product_key}', '${o.title}', ${o.price})">
                    <img src="${o.image_url}" style="width:100%; display:block; max-height:150px; object-fit:cover;">
                    <div style="padding:10px;"><h4>${o.title} - ${o.price} TK</h4></div>
                </div>`;
                container.innerHTML += html;
            });
        });
    }

    // ================== ORDER LOGIC ==================
    let selectedOrder = {}; 
    let payMethod = 'wallet';

    function openOrderPage(productKey, title, fixedPrice = null) {
        selectedOrder = { title: title, price: 0, productKey: productKey };
        document.getElementById('orderTitleDisplay').innerText = title;
        document.getElementById('orderPriceDisplay').innerText = "0 TK";
        if(currentUserData) {
            document.getElementById('orderPageBalance').innerText = currentUserData.balance.toFixed(2);
        }
        document.getElementById('playerIdInput').value = '';
        
        const gridContainer = document.getElementById('packageGridContainer');
        const selectionSection = document.getElementById('packageSelectionSection');
        
        if (fixedPrice !== null) {
            // It's a direct offer
            selectedOrder.price = fixedPrice;
            document.getElementById('orderPriceDisplay').innerText = fixedPrice + " TK";
            selectionSection.style.display = 'none';
        } else {
            // It's a product with packages, fetch dynamically
            selectionSection.style.display = 'block';
            gridContainer.innerHTML = '<div style="grid-column: span 2; text-align:center;">Loading Packages...</div>';
            
            db.collection('packages')
              .where('product_key', '==', productKey)
              .orderBy('sort_order', 'asc')
              .get().then(snap => {
                  gridContainer.innerHTML = '';
                  if(snap.empty) {
                      gridContainer.innerHTML = '<div style="grid-column: span 2; text-align:center;">No packages found</div>';
                      return;
                  }
                  
                  // Temporary array to store package data for click handlers
                  window.currentPackages = [];
                  
                  snap.forEach(doc => {
                      const pkg = doc.data();
                      window.currentPackages.push(pkg);
                      const index = window.currentPackages.length - 1;
                      
                      const html = `
                        <div class="package-card" onclick="selectPackage(${index}, this)">
                            <div class="pkg-check-icon"><i class="fas fa-check-circle"></i></div>
                            <div class="pkg-name">${pkg.name}</div>
                            <div class="pkg-price">${pkg.price} TK</div>
                        </div>`;
                      gridContainer.innerHTML += html;
                  });
              });
        }
        router('order-form');
    }

    function selectPackage(index, el) {
        document.querySelectorAll('.package-card').forEach(c => c.classList.remove('active-pkg'));
        el.classList.add('active-pkg');
        const pkg = window.currentPackages[index];
        selectedOrder.price = pkg.price;
        selectedOrder.packageName = pkg.name;
        document.getElementById('orderPriceDisplay').innerText = pkg.price + " TK";
    }

    function selectPayOption(el, method) {
        document.querySelectorAll('.pay-option-card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        payMethod = method;
    }

    function checkUID() { alert("নাম চেক করা হচ্ছে... (Demo)"); }

    async function confirmOrder() {
        const uid = document.getElementById('playerIdInput').value;
        if(!uid) { alert("Please Enter Player ID / Info"); return; }
        if(!selectedOrder.price || selectedOrder.price <= 0) { alert("Please select a package."); return; }
        if(currentUserData.balance < selectedOrder.price) {
            alert("আপনার ব্যালেন্সে পর্যাপ্ত পরিমাণ টাকা নেই। দয়া করে Add Money করুন।");
            router('addmoney');
            return;
        }

        const btn = document.getElementById('btnConfirmOrder');
        btn.disabled = true; btn.innerText = "Processing...";

        const titleText = selectedOrder.packageName ? `${selectedOrder.title} (${selectedOrder.packageName})` : selectedOrder.title;

        try {
            await db.runTransaction(async (t) => {
                const userRef = db.collection('users').doc(currentUserUid);
                const doc = await t.get(userRef);
                const newBalance = doc.data().balance - selectedOrder.price;
                if (newBalance < 0) throw "Insufficient funds";

                t.update(userRef, { balance: newBalance });
                const orderRef = db.collection('orders').doc();
                t.set(orderRef, {
                    user_uid: currentUserUid,
                    title: titleText,
                    price: selectedOrder.price,
                    uid: uid,
                    status: 'Processing',
                    date: new Date().toLocaleString(),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    method: payMethod,
                    user_phone: currentUserData.phone
                });
            });
            alert("অর্ডার সফল হয়েছে!");
            router('orders');
        } catch (e) {
            console.error(e);
            alert("Transaction Failed: " + e);
        }
        btn.disabled = false; btn.innerText = "Buy Now";
    }

    // ================== ADD MONEY ==================
    let amData = { amount: 50, method: {}, trx: '' };
    let availableMethods = [];

    function renderPaymentMethods() {
        const container = document.getElementById('paymentMethodsContainer');
        container.innerHTML = 'Loading...';
        
        db.collection('payment_methods').get().then(snap => {
            container.innerHTML = '';
            availableMethods = [];
            snap.forEach(doc => {
                const m = doc.data();
                availableMethods.push(m);
                const index = availableMethods.length - 1;
                
                const html = `
                <div class="method-box" onclick="amSelectMethod(${index})">
                    <img src="${m.icon}" alt="${m.name}">
                    <div class="method-name">${m.name}</div>
                </div>`;
                container.innerHTML += html;
            });
        });
    }

    function amGoToStep2() {
        let val = parseFloat(document.getElementById('amAmount').value);
        let min = globalConfig.min_add_money || 50;
        
        if(val < min) { alert(`সর্বনিম্ন ${min} টাকা অ্যাড করতে হবে`); return; }
        
        amData.amount = val;
        document.getElementById('displayAmount').innerText = amData.amount;
        document.getElementById('am_step1').style.display = 'none';
        document.getElementById('am_step2').style.display = 'block';
    }

    function amSelectMethod(index) {
        amData.method = availableMethods[index];
        document.getElementById('finalAm').innerText = amData.amount;
        
        const card = document.getElementById('instructionCard');
        card.style.background = amData.method.color;
        document.getElementById('dialCode').innerText = amData.method.dial;
        document.getElementById('adminNumber').innerText = amData.method.number;
        
        document.getElementById('am_step2').style.display = 'none';
        document.getElementById('am_step3').style.display = 'block';
    }

    function resetAddMoney() {
        document.getElementById('am_step1').style.display = 'block';
        document.getElementById('am_step2').style.display = 'none';
        document.getElementById('am_step3').style.display = 'none';
    }

    function submitVerify() {
        const trx = document.getElementById('trxIDInput').value;
        if(!trx) { alert("অনুগ্রহ করে ট্রানজেকশন আইডি দিন"); return; }
        
        const btn = document.getElementById('btnSubmitTrx');
        btn.disabled = true; btn.innerText = "Checking...";

        db.collection('transactions').add({
            user_uid: currentUserUid,
            trx: trx,
            amount: amData.amount,
            method: amData.method.name,
            adminNumber: amData.method.number,
            status: 'Processing',
            date: new Date().toLocaleString(),
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            user_phone: currentUserData.phone
        }).then(() => {
            alert("আপনার Add Money রিকুয়েস্ট রিসিভ হয়েছে।");
            document.getElementById('trxIDInput').value = '';
            btn.disabled = false; btn.innerText = "VERIFY";
            resetAddMoney();
            router('transactions');
        }).catch((err) => {
            alert("Error: " + err);
            btn.disabled = false; btn.innerText = "VERIFY";
        });
    }

    // ================== TUTORIALS ==================
    function renderVideos(page) {
        const container = page === 'home' ? document.getElementById('videoListContainer') : document.getElementById('addMoneyVideoContainer');
        const queryPage = page === 'home' ? 'how_to_work' : 'add_money_help';
        
        container.innerHTML = "Loading...";
        
        db.collection('tutorials').where('page', '==', queryPage).get().then(snap => {
            container.innerHTML = "";
            if(snap.empty && page === 'home') container.innerHTML = "<p>No videos found</p>";

            snap.forEach(doc => {
                const v = doc.data();
                if(page === 'home') {
                    container.innerHTML += `
                    <div class="video-card" onclick="window.open('${v.video_url}','_blank')">
                        <div class="video-thumb"><i class="fas fa-play-circle" style="font-size:50px; color:white;"></i></div>
                        <div class="video-info"><h4>${v.title}</h4><p>Click to watch</p></div>
                    </div>`;
                } else {
                    // Add money small card
                    container.innerHTML = `
                    <h5 style="margin-bottom:5px;">How to add money</h5>
                    <div style="background:#000; height:150px; display:flex; justify-content:center; align-items:center; color:white; border-radius:8px; cursor:pointer;" onclick="window.open('${v.video_url}','_blank')">
                        <i class="fas fa-play-circle" style="font-size:40px;"></i>
                    </div>`;
                }
            });
        });
    }

    // ================== NAVIGATION & ROUTER ==================
    function router(pageId) {
        document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
        document.getElementById('main-app').classList.add('hide');
        document.getElementById('pg-login').classList.remove('active');
        document.getElementById('pg-register').classList.remove('active');

        if(pageId === 'login') {
            document.getElementById('pg-login').classList.add('active');
        } else if (pageId === 'register') {
            document.getElementById('pg-register').classList.add('active');
        } else {
            document.getElementById('main-app').classList.remove('hide');
            document.getElementById('pg-' + pageId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            let navBtn = document.getElementById('nav-' + (pageId === 'order-form' ? 'home' : pageId));
            if(navBtn) navBtn.classList.add('active');
            
            if(pageId === 'transactions') fetchTransactions();
            if(pageId === 'orders') fetchOrders();
            if(pageId === 'addmoney') { renderPaymentMethods(); renderVideos('addmoney'); }
            if(pageId === 'howtowork') renderVideos('home');
        }
        window.scrollTo(0,0);
    }

    function toggleSideMenu() {
        const menu = document.getElementById('sideMenu');
        const overlay = document.getElementById('overlay');
        if(menu.classList.contains('open')) { menu.classList.remove('open'); overlay.classList.remove('active'); }
        else { menu.classList.add('open'); overlay.classList.add('active'); }
    }

    function openContactModal() { document.getElementById('contactModal').style.display = 'flex'; }
    function closeContactModal() { document.getElementById('contactModal').style.display = 'none'; }

    // ================== FETCH & RENDER LISTS (ORDERS & TRX) ==================
    function fetchTransactions() {
        const container = document.getElementById('trxListContainer');
        container.innerHTML = '<div style="text-align:center; padding:10px;">Loading...</div>';
        
        db.collection('transactions')
          .where('user_uid', '==', currentUserUid)
          .orderBy('timestamp', 'desc')
          .limit(20)
          .get()
          .then((snapshot) => {
              if (snapshot.empty) {
                  container.innerHTML = '<div class="trx-row" style="text-align:center; color:#999; padding:20px;">No Data Found</div>';
                  return;
              }
              let html = '';
              snapshot.forEach((doc) => {
                  const t = doc.data();
                  let statusClass = t.status === 'Approved' ? 'st-approved' : (t.status === 'Rejected' ? 'st-rejected' : 'st-processing');
                  let badgeClass = t.status === 'Approved' ? 'sb-approved' : (t.status === 'Rejected' ? 'sb-rejected' : 'sb-processing');
                  
                  html += `
                    <div class="trx-row ${statusClass}" style="border-left: 3px solid;">
                        <div class="trx-meta">
                            <b>${t.date.split(',')[0]}</b><br>
                            ${t.method}
                        </div>
                        <div style="font-size:11px;">
                            <span class="trx-id">#${t.trx}</span>
                            <span class="status-badge ${badgeClass}">${t.status}</span>
                        </div>
                        <div style="font-weight:bold; color:var(--text-dark);">${t.amount} ৳</div>
                    </div>`;
              });
              container.innerHTML = html;
          });
    }

    function fetchOrders() {
        const container = document.getElementById('orderListContainer');
        container.innerHTML = '<div style="text-align:center; padding:10px;">Loading...</div>';

        db.collection('orders')
          .where('user_uid', '==', currentUserUid)
          .orderBy('timestamp', 'desc')
          .limit(20)
          .get()
          .then((snapshot) => {
              if (snapshot.empty) {
                  container.innerHTML = '<div class="empty-state">No order data found!</div>';
                  return;
              }
              let html = '';
              snapshot.forEach((doc) => {
                  const o = doc.data();
                  let statusClass = o.status === 'Approved' ? 'st-approved' : (o.status === 'Rejected' ? 'st-rejected' : 'st-processing');
                  let badgeClass = o.status === 'Approved' ? 'sb-approved' : (o.status === 'Rejected' ? 'sb-rejected' : 'sb-processing');

                  html += `
                    <div class="order-item ${statusClass}">
                        <div style="display:flex; justify-content:space-between;">
                            <span style="font-weight:bold;">${o.title}</span>
                            <span class="status-badge ${badgeClass}">${o.status}</span>
                        </div>
                        <div style="font-size:12px; color:#666; margin-top:5px;">
                            UID: ${o.uid} <br> Price: ${o.price} TK | ${o.date}
                        </div>
                    </div>`;
              });
              container.innerHTML = html;
          });
    }

</script>

</body>
</html>